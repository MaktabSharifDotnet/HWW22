@using App.Domain.Core.Dtos.ProductAgg
@model ProductDto

@{
    ViewData["Title"] = Model.Title ;
}

<link href="~/css/product-detail.css" rel="stylesheet" />

<div class="container py-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index" class="text-decoration-none text-muted">خانه</a></li>
            <li class="breadcrumb-item active" aria-current="page">@Model.Title</li>
        </ol>
    </nav>

    @if (Model != null)
    {
        <div class="product-detail-card">
            <div class="row">
                <div class="col-lg-4 col-md-5 mb-4 mb-md-0">
                    <div class="product-gallery">
                        <img src="~/images/ProductsAgg/@(string.IsNullOrEmpty(Model.Image) ? "default.jpg" : Model.Image)"
                             alt="@Model.Title"
                             class="img-fluid" />
                    </div>
                </div>

                <div class="col-lg-5 col-md-7">
                    <div class="product-info">
                        <span class="category-badge">
                            <i class="bi bi-folder2-open"></i> @Model.CategoryName
                        </span>

                        <h1 class="product-title-detail">@Model.Title</h1>

                        <ul class="feature-list mt-3">
                            <li>
                                <i class="bi bi-shield-check"></i> گارانتی اصالت و سلامت فیزیکی کالا
                            </li>
                            <li>
                                <i class="bi bi-truck"></i> ارسال سریع و ایمن
                            </li>
                            @if (Model.Inventory > 0)
                            {
                                <li>
                                    <i class="bi bi-shop"></i> موجود در انبار
                                </li>
                            }
                        </ul>

                        <div class="divider"></div>

                        <h5 class="fw-bold mb-3">معرفی محصول</h5>

                        <div class="description-box">
                            @Html.Raw(Model.Description.Replace("\n", "<br>"))
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 mt-4 mt-lg-0">
                    <div class="purchase-box sticky-top" style="top: 20px;">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="text-muted small">قیمت فروشنده:</span>
                        </div>

                        <div class="mb-4 text-start">
                            <span class="price-value">@Model.Price.ToString("N0")</span>
                            <span class="currency-symbol">تومان</span>
                        </div>

                        @if (Model.Inventory > 0)
                        {
                            @if (Model.Inventory < 5)
                            {
                                <div class="inventory-alert text-danger fw-bold mb-2">
                                    <i class="bi bi-exclamation-triangle-fill"></i> تنها @Model.Inventory عدد در انبار باقی مانده!
                                </div>
                            }
                            else
                            {
                                <div class="inventory-alert text-success fw-bold mb-2">
                                    <i class="bi bi-check-circle-fill"></i> موجود در انبار (@Model.Inventory عدد)
                                </div>
                            }

                            <a asp-controller="Cart"
                               asp-action="Add"
                               asp-route-productId="@Model.Id"
                               class="btn-add-cart">
                                <i class="bi bi-cart-plus-fill me-2"></i> افزودن به سبد خرید
                            </a>

                            <div class="mt-3 text-muted small text-center">
                                <i class="bi bi-info-circle"></i> درخواست مرجوعی کالا با دلیل "انصراف از خرید" تنها در صورتی قابل تایید است که کالا در شرایط اولیه باشد.
                            </div>
                        }
                        else
                        {
                            <div class="inventory-alert text-danger border-bottom pb-3 mb-3">
                                <div class="text-danger fw-bold">
                                    <i class="bi bi-x-circle-fill"></i> ناموجود
                                </div>
                            </div>
                            <button class="btn-disabled" disabled>
                                این کالا فعلا موجود نیست
                            </button>
                        }
                    </div>
                </div>

            </div>
        </div>
    }
    else
    {
        <div class="alert alert-danger text-center mt-5">
            محصول مورد نظر یافت نشد.
            <br />
            <a asp-controller="Home" asp-action="Index" class="btn btn-outline-danger mt-3">بازگشت به خانه</a>
        </div>
    }
</div>