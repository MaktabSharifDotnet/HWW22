@using App.Domain.Core.Dtos.OrderItemAgg
@model List<OrderItemDto>

@{
    ViewData["Title"] = "جزئیات اقلام سفارش";
  
    var orderId = Model.FirstOrDefault()?.OrderId;
}

@section Styles {
    <link rel="stylesheet" href="~/css/order-detail.css" />
}

<div class="container-fluid">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="fw-bold text-secondary">
            <i class="bi bi-list-check"></i> اقلام سفارش
            @if (orderId != null)
            {
                <span class="text-primary">#@orderId</span>
            }
        </h4>

        <a asp-action="Index" asp-controller="Order" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-right"></i> بازگشت به لیست
        </a>
    </div>

    <div class="order-detail-card">
        @if (Model != null && Model.Any())
        {
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead>
                        <tr>
                            <th style="width: 50px;">#</th>
                            <th>نام محصول</th>
                            <th class="text-center">تعداد</th>
                            <th>قیمت واحد (تومان)</th>
                            <th>قیمت کل (تومان)</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            int rowCount = 1;
                        }
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>@(rowCount++)</td>

                                <td class="product-name">
                                    @item.Name
                                    <span class="d-block small text-muted font-weight-normal">کد محصول: @item.ProductId</span>
                                </td>

                                <td class="text-center">
                                    <span class="badge bg-light text-dark border badge-count">@item.Count</span>
                                </td>

                                <td>@item.UnitPrice.ToString("N0")</td>

                                <td class="text-primary fw-bold">
                                    @item.TotalPrice.ToString("N0")
                                </td>
                            </tr>
                        }
                    </tbody>

                    <tfoot>
                        <tr class="total-row">
                            <td colspan="4" class="text-end">جمع کل اقلام:</td>
                            <td class="text-success">
                                @Model.Sum(x => x.TotalPrice).ToString("N0") تومان
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        }
        else
        {
            <div class="alert alert-warning text-center">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                هیچ آیتمی برای نمایش در این سفارش یافت نشد.
            </div>
        }
    </div>
</div>